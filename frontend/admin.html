<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurantes - Admin PedeAi</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <script src="js/auth-guard.js"></script>
</head>
<body>
    <div class="admin-wrapper">
        <aside class="admin-sidebar">
            <div class="sidebar-logo">PedeAi<span style="color:var(--color-primary)">.</span></div>
            <nav class="sidebar-menu">
                <a href="admin.html" class="sidebar-link active"><span>ğŸ¢</span> Restaurantes</a>
                <a href="admin-products.html" class="sidebar-link"><span>ğŸ”</span> Produtos</a>
                <a href="admin-orders.html" class="sidebar-link"><span>ğŸ””</span> Pedidos</a>
                <a href="admin-finance.html" class="sidebar-link"><span>ğŸ’°</span> Financeiro</a>
                <a href="admin-store.html" class="sidebar-link"><span>âš™ï¸</span> Minha Loja</a>
                <div style="margin-top: auto;">
                    <a href="/" class="sidebar-link" target="_blank" style="margin-bottom: 5px;"><span>ğŸ”—</span> Ver Loja</a>
                    <a href="#" onclick="logout()" class="sidebar-link" style="color: var(--color-danger);"><span>ğŸšª</span> Sair</a>
                </div>
            </nav>
        </aside>

        <main class="admin-content">
            <header class="page-header">
                <h1 class="page-title">Cadastrar Restaurante</h1>
            </header>

            <div class="admin-card">
                <form id="create-form" enctype="multipart/form-data">
                    
                    <div class="form-group">
                        <label class="form-label">Nome do Restaurante</label>
                        <input type="text" name="name" class="form-input" required placeholder="Ex: Burger Kingish">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Slug (URL)</label>
                        <input type="text" name="slug" class="form-input" required placeholder="Ex: burger-kingish">
                    </div>

                    <div style="background: #f0fdf4; padding: 15px; border-radius: 8px; border: 1px dashed var(--color-primary); margin: 20px 0;">
                        <h4 style="margin-bottom: 10px; color: var(--color-primary); font-size: 0.95rem;">ğŸ” Acesso (Login)</h4>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" name="email" class="form-input" required placeholder="admin@restaurante.com">
                        </div>
                        <div class="form-group" style="margin-bottom:0;">
                            <label class="form-label">Senha</label>
                            <input type="text" name="password" class="form-input" required value="123456">
                        </div>
                    </div>

                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border: 1px dashed #ffc107; margin-bottom: 20px;">
                        <h4 style="margin-bottom: 10px; color: #856404; font-size: 0.95rem;">â° HorÃ¡rio de Funcionamento</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label class="form-label">Abre Ã s</label>
                                <input type="time" name="opensAt" class="form-input" required value="18:00">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Fecha Ã s</label>
                                <input type="time" name="closesAt" class="form-input" required value="23:59">
                            </div>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Categoria</label>
                            <select name="category" class="form-select">
                                <option value="Hamburgueria">Hamburgueria</option>
                                <option value="Pizzaria">Pizzaria</option>
                                <option value="JaponÃªs">JaponÃªs</option>
                                <option value="Brasileira">Brasileira</option>
                                <option value="Doces">Doces</option>
                                <option value="SaudÃ¡vel">SaudÃ¡vel</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Tempo Entrega</label>
                            <input type="text" name="deliveryTime" class="form-input" placeholder="Ex: 30-40 min">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">Taxa (R$)</label>
                            <input type="number" step="0.01" name="deliveryFee" class="form-input" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nota</label>
                            <input type="number" step="0.1" name="rating" class="form-input" value="5.0">
                        </div>
                    </div>

                    <div class="form-group" style="margin-top:20px;">
                        <label class="form-label">Capa</label>
                        <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                            <label style="cursor:pointer; display:flex; align-items:center; gap:5px;">
                                <input type="radio" name="imgType" value="link" checked onchange="toggleImageInput()"> ğŸ”— Link
                            </label>
                            <label style="cursor:pointer; display:flex; align-items:center; gap:5px;">
                                <input type="radio" name="imgType" value="file" onchange="toggleImageInput()"> ğŸ“‚ Arquivo
                            </label>
                        </div>

                        <div id="container-link">
                            <input type="url" name="image" id="input-link" class="form-input" value="https://images.unsplash.com/photo-1550547660-d9450f859349?w=500">
                        </div>

                        <div id="container-file" style="display: none;">
                            <input type="file" name="imageFile" id="input-file" class="file-input-hidden" accept="image/*">
                            <label for="input-file" class="file-upload-label">
                                <div class="upload-icon">ğŸ“</div>
                                <div>Clique para selecionar</div>
                            </label>
                            <div id="preview-container" class="image-preview-container">
                                <img id="image-preview" class="image-preview" src="">
                                <button type="button" class="preview-remove-btn" onclick="clearFileInput()">Ã—</button>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit">Salvar Restaurante</button>
                </form>
            </div>
        </main>
    </div>

    <script>
        const API = 'https://pede-ai.onrender.com/api';

        // 1. Auth Check
        (async () => {
            const token = localStorage.getItem('pedeai_token');
            if(!token) return;
            try {
                const res = await fetch(`${API}/auth/me`, { headers: { 'Authorization': `Bearer ${token}` } });
                const json = await res.json();
                if (json.success && json.data.role !== 'admin') {
                    alert('Apenas Admin pode criar lojas.');
                    window.location.href = 'admin-orders.html';
                }
            } catch(e) { console.error(e); }
        })();

        // 2. Toggle Imagem
        function toggleImageInput() {
            const type = document.querySelector('input[name="imgType"]:checked').value;
            const cLink = document.getElementById('container-link');
            const cFile = document.getElementById('container-file');
            
            if (type === 'link') {
                cLink.style.display = 'block'; cFile.style.display = 'none';
                clearFileInput();
            } else {
                cLink.style.display = 'none'; cFile.style.display = 'block';
                document.getElementById('input-link').value = '';
            }
        }

        // 3. Preview Imagem
        const fileInput = document.getElementById('input-file');
        const previewContainer = document.getElementById('preview-container');
        const previewImage = document.getElementById('image-preview');
        const uploadLabel = document.querySelector('.file-upload-label');

        fileInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    previewContainer.style.display = 'block';
                    uploadLabel.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        function clearFileInput() {
            fileInput.value = '';
            previewContainer.style.display = 'none';
            uploadLabel.style.display = 'flex';
        }

        // 4. Submit
        document.getElementById('create-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target); // Pega TUDO, inclusive opensAt/closesAt
            const token = localStorage.getItem('pedeai_token');
            
            try {
                const res = await fetch(`${API}/restaurants`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                const json = await res.json();
                if(json.success) { 
                    alert('âœ… Restaurante Criado!'); 
                    e.target.reset(); 
                    document.querySelector('input[value="link"]').checked = true;
                    toggleImageInput();
                } else { alert('Erro: ' + json.message); }
            } catch(err) { alert('Erro de conexÃ£o'); }
        });
    </script>
</body>
</html>